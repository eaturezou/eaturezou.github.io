---
layout: post
author: eature
published: true
categories: nginx
modify: 2018-01-14
tags:
- nginx
- 架构
---
文档阅读笔记，后期可继续加深
1. nginx在启动后，会有一个master进程和多个worker进程。master呼不出个办法用来管理worker进程，而基本的网络事件，则是放在worker进程中来处理，多个worker进程是对等的，独立的，一个请求只能在一个worker进程中处理。worker进程数是可以设置的，一般设置与cpu的核数相同。
2. master管理worker进程，会接收来自外界的信号，在根据信号做不同的事情
>首先master进程在接到信号后，会先重新加载配置文件，然后再启动新的worker进程，并向所有老的worker进程发送信号，告诉他们可以光荣退休了。新的worker在启动后，就开始接收新的请求，而老的worker在收到来自master的信号后，就不再接收新的请求，并且在当前进程中的所有未处理完的请求处理完成后，再退出。

3. nginx采用这种进程模型，好处很多，首先，对于每个worker进程来说，都是相互独立的，不需要加锁，节省了加锁的开销，然后，进程间相互独立，互不影响，但其中一个进程挂掉后，也不会影响其他进程继续跑

4. Nginx采用的是异步非阻塞模型，所谓阻塞与非阻塞就是，当事件还没有准备好的时候，祖泽模型会一直等待到事件准备后，往后的进程则需要等待前面一个进程完成后再执行，而非阻塞进程则比较乐观了，若事件没准备好，就再过一会儿再过来看看事件有没有准备好，在这期间，可以先做些别的事情  
 再往下的异步非阻塞其实就是，非阻塞模型虽然不阻塞了，但是不时的查看事件是否准备好也需要不小的开销，所以像`select/poll/epoll/kqueue`这些系统调用，提供了一种机制，可以监听多个事件，调用他们是阻塞的，可以设置超时时间，在超时时间内，事件准备好了，就返回。
